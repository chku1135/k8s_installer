#portainer
#참고: https://ko.linux-console.net/?p=7941

#portainer-k8s cluster 연동
 > helm install 선행

1. cluster에 portainer 배포
#portainer repository를 helm 추가
helm repo add portainer https://portainer.github.io/k8s/
helm repo update

2.portainer service 노출(선택)
2-1. nodePort로 portainer 노출
helm install --create-namespace -n portainer portainer portainer/portainer

2-2. 로드 밸런서 사용 portainer 노출(LoadBalancer 있는 경우)
helm install --create-namespace -n portainer portainer portainer/portainer --set service.type=LoadBalancer

2-3. 인그레스 경로로 portainer 노출(DNS > portainer.exemple.com)
helm install --create-namespace -n portainer portainer portainer/portainer \
  --set service.type=ClusterIP \
  --set ingress.enabled=true \
  --set ingress.annotations.'kubernetes\.io/ingress\.class'=nginx \
  --set ingress.annotations."nginx\.ingress\.kubernetes\.io/backend-protocol"=HTTPS \
  --set ingress.hosts[0].host=portainer.exemple.com \
  --set ingress.hosts[0].paths[0].path="/"

3. IP or Ingress host로 브라우저 접근
3-1. main > "Create user"
3-2. main > "Quick Setup" > "Get Started"

4. portainer에 k8s cluster 추가
4-1. Environments > Add Environments > "Kubernetes" 선택
4-2. NodePort or LoadBalancer 사용 > portainer agent를 cluster에 추가
    - Kubernetes via load balancer or kubernetes via node port 선택
    - copy command > 터미널에서 실행
    - Name, Environments URL 입력
    - Connect
4-3. k8s service 확인
kubectl get service -n portainer
 > portainer-agent service 확인
